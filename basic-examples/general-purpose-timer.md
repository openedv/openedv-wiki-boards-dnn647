---
title: 'General Purpose Timer'
sidebar_position: 9
---

# General Purpose Timer

通用定时器实验

## 前言

本章我们主要来学习通用定时器，上一章我们知道STM32N647有13个通用定时器（TIM2-TIM5，TIM9-TIM17）。我们将通过四个实验来学习通用定时器的各个功能，分别是通用定时器中断实验、通用定时器PWM输出实验、通用定时器输入捕获实验和通用定时器脉冲计数实验。

本章内容包含了以下四个部分：

1.通用定时器中断实验：LED1用来指示程序正在运行，200ms翻转一次。LED0在定时器中断中翻转，500ms进入中断一次。

2.通用定时器PWM输出实验：使用TIM3通道1输出PWM，TIM3通道1对应的PC6，可以通过示波器接入PC6查看PWM输出。

3.通用定时器输入捕获实验：使用TIM3_CH1来做输入捕获，捕获PC6上的低电平脉宽，并将脉宽时间通过串口打印出来，通过按KEY0按键，模拟输入低电平，例程中能测试的最长低电平脉宽时间为：4194240us。

4.通用定时器脉冲计数实验：使用TIM3_CH1做输入捕获，我们将捕获PC6上的低电平脉宽，并对脉宽进行计数，通过串口打印出来。大家可以通过按KEY0按键，输入低电平脉冲，通过按KEY1重设当前计数。LED1闪烁，提示程序运行。



## 实验准备

1. 编写成功后，切换BOOT1跳线帽至3.3V处，便可进行程序下载，下载完之后，将BOOT1跳线帽切换回GND处，对开发板重新上电。

2. 四个不同实验需要进行不同的实验准备

   通用定时器中断实验：开发板重新上电后便可以观察到实验现象。

   通用定时器PWM输出实验：将示波器探头接入PC6，调节合适的挡位（PWM频率约2KHz）。

   通用定时器输入捕获实验：将开发板的USB_UART端连接电脑，然后打开串口调试助手XCOM，连接上开发板对应的端口。

   通用定时器脉冲计数实验：将开发板的USB_UART端连接电脑，然后打开串口调试助手XCOM，连接上开发板对应的端口。

## 实验现象

通用定时器中断实验：下载代码后，可以看到LED1不停闪烁（每400ms一个周期），而LED0也是不停的闪烁，但是闪烁时间较LED1慢（每1s一个周期）。

通用定时器PWM输出实验：下载代码后，可通过示波器查看到变化的PWM输出，假设当比较值固定为200时，占空比 = CCR1 / (arr+1) = 200/500=40%。可以看到输出比较极性为低和输出比较极性为高的占空比正好反过来，如下图所示：

![02](./img/02.png)

我们默认设置的是输出比较极性低，如黄色波形所示。

通用定时器输入捕获实验：下载代码后，按下KEY0，可以看到XCOM输入低电平脉宽时间，我们可以通过久按测试，上位机输出不同的低电平脉宽时间，单次采集时间最高为4194240us。

![02](./img/03.png)

通用定时器脉冲计数实验：下载代码后，按下KEY0，开发板会统计按下次数并通过串口输出，如果按下KEY1，会对统计次数清0，如下图所示：查看到按下次数

![02](./img/04.png)
