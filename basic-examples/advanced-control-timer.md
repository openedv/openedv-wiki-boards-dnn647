---
title: 'Advanced Control Timer'
sidebar_position: 10
---

# Advanced Control Timer

高级定时器实验

## 前言

本章我们主要来学习高级定时器， STM32N647有2个高级定时器（TIM1和TIM8）。我们将通过四个实验来学习高级定时器的各个功能，分别是高级定时器输出指定个数PWM实验、高级定时器输出比较模式实验、高级定时器互补输出带死区控制实验和高级定时器PWM输入模式实验。

本章内容包含了以下四个部分：

1.高级定时器输出指定个数PWM实验：通过TIM1_CH1(PC6)输出PWM，按一下按键KEY1，就会输出5个PWM信号，可以用DS100示波器辅助查看。

2.高级定时器输出比较模式实验：使用输出比较模式的翻转功能，通过定时器1的2路通道输出占空比固定为50%、相位分别是25%和50%的PWM(PC6和PD7)。

3.高级定时器互补输出带死区控制实验：利用TIM1_CH1(PC6)输出70%占空比的PWM，它的互补输出通道(PE8)则是输出30%占空比的PWM。刹车功能，当给刹车输入引脚(PE15)输入高电平时，进行刹车，即PC6和PE8停止输出PWM。

4.高级定时器PWM输入模式实验：首先通过TIM3_CH1(PC6)输出PWM波。然后把PC6输出的PWM波用杜邦线接入PD6（定时器1通道1），最后通过串口打印PWM波的脉宽和频率等信息。LED1闪烁来提示程序正在运行。



## 实验准备

1. 编写成功后，切换BOOT1跳线帽至3.3V处，便可进行程序下载，下载完之后，将BOOT1跳线帽切换回GND处，对开发板重新上电。

2. 四个不同实验需要进行不同的实验准备

   高级定时器输出指定个数PWM实验：将示波器探头接入PC6，调节合适的挡位（PWM频率约2Hz）。

   高级定时器输出比较模式实验：将示波器探头接入PC6和PD7，调节合适的挡位（PWM频率约500Hz）。

   高级定时器互补输出带死区控制实验：将示波器探头接入PC6和PE8，调节合适的挡位（PWM频率约1KHz），用一根杜邦线连接PE15和GND，用于测试刹车功能。

   高级定时器PWM输入模式实验：用杜邦线连接PC6和PD6，然后将开发板的USB_UART端连接电脑，然后打开串口调试助手XCOM，连接上开发板对应的端口。

## 实验现象

高级定时器输出指定个数PWM实验：我们每按一下按键KEY1，就会输出5个PWM。下面我们使用正点原子DS100手持数字示波器，把PC6引脚的波形截获，如下图所示：

![02](./img/05.png)

由图可知频率为2Hz，大家可以自行测量。

高级定时器输出比较模式实验：下下载代码后，可以看到LED1在闪烁，说明程序已经正常在跑了。 我们需要借助示波器观察PC6和PD7引脚PWM输出的情况，我们已经把示波器的显示内容截图出来，如下图所示：

![02](./img/06.png)

高级定时器互补输出带死区控制实验：载代码后，可以看到LED1在闪烁，说明程序已经正常在跑了。 我们需要借助示波器观察PC6正常输出和PE8互补输出PWM的情况.

![02](./img/07.png)

死区时间计算可分为以下两步：

第一步：通过CKD[1:0]位确定tDTS。根据CKD[1:0]位的描述，可以得到下面的式子：

```c
tDTS=2^CKD[1:0]/Tclk=2^0/400000000=2.5ns
```

死区时间=100*tDTS=250ns，大家可以用示波器测试下，

![02](./img/09.png)

如果将PE15接入高电平后，PC6和PE8停止输出PWM。

高级定时器PWM输入模式实验：下载代码后，可以看到LED1在闪烁，说明程序已经正常在跑了，我们再打开串口调试助手，选择对应的串口端口。然后用杜邦线把PC6引脚连接到PD6引脚，就可以看到串口助手不断打印PWM波的信息

![02](./img/08.png)
